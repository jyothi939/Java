trigger:
- main

pool:
  name: Test   # Your self-hosted agent pool

stages:
- stage: Build
  displayName: Build and Push Docker Image
  jobs:
    - job: Build
      displayName: Build Docker Image
      steps:
        # Checkout the GitHub repository automatically
        - checkout: self
          displayName: 'Checkout GitHub Code'

        # Build and push Docker image
        - task: Docker@2
          displayName: 'Build and Push Docker Image'
          inputs:
            containerRegistry: 'con1'       # Your ACR service connection
            repository: 'myapp'            # Docker image name
            command: 'buildAndPush'
            Dockerfile: '**/Dockerfile'    # Path to Dockerfile in GitHub repo
            buildContext: '.'              # Context folder containing the Dockerfile
